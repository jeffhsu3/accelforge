renames:
  version: "0.5"
  einsums:
  - name: default
    tensor_accesses:
    - name: input
      source: Inputs() & Intermediates()
      injective: True
    - name: output
      source: Outputs()
      injective: True
    - name: weight
      source: ~(input | output)
      injective: True

    rank_variables:
    - name: head
      source: h
      injective: True
    - name: parallel_rank
      source: output.rank_variables() & weight.rank_variables() - head
      injective: True
    - name: reduced_rank
      source: input.rank_variables() & weight.rank_variables() - head - output.rank_variables() - parallel_rank
      injective: True

  - name: I
    tensor_accesses:
    - name: weight
      source: Nothing
    - name: input
      source: Inputs()
    {% if FFMT | default(false) %}
    - name: Intermediates
      source: Nothing
    {% endif %}
    rank_variables:
    - {name: head, source: Nothing().rank_variables()}
    - {name: reduced_rank, source: b, injective: True}
    - {name: parallel_rank, source: m, injective: True}

  - name: QK
    tensor_accesses:
    - name: input
      source: Q
      injective: True
    rank_variables:
    - {name: parallel_rank, source: m, injective: True}

  - name: AV
    tensor_accesses:
    - name: input
      source: QK
      injective: True
    rank_variables:
    - {name: parallel_rank, source: f, injective: True}
    # - {name: reduced_rank, source: p, injective: True}

  - name: FFA
    rank_variables:
    - {name: head, source: Nothing().rank_variables()}

  - name: FFB
    rank_variables:
    - {name: head, source: Nothing().rank_variables()}
  
