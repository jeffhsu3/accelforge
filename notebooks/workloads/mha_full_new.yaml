workload:
  version: 0.5
  shape:
    b: 0 <= b < 1
    m: 0 <= m < 1
    h: 0 <= h < 1
    e: 0 <= e < 1
    d: 0 <= d < 1
    c: 0 <= c < 1
    j: 0 <= j < 1
    g: 0 <= g < 1

  einsums:
  - name: V
    tensors:
    - {name: I, projection: [ b, m, d ]}
    - {name: WV, projection: [ h, e, d ]}
    - {name: V, projection: [ b, m, h, e ], output: True}

  - name: K
    tensors:
    - {name: I, projection: [ b, m, d ]} 
    - {name: WK, projection: [ h, e, d ]}
    - {name: K, projection: [ b, m, h, e ], output: True}

  - name: Q
    tensors:
    - {name: I, projection: [ b, m, d ]}
    - {name: WQ, projection: [ h, e, d ]}
    - {name: Q, projection: [ b, m, h, e ], output: True}

  - name: QK
    tensors:
    - {name: Q, projection: [ b, m, h, e ]}
    - {name: K, projection: { B: b, M: P, H: h, E: e }}
    - {name: QK, projection: [ b, m, p, h ], output: True}

  - name: AV
    tensors:
    - {name: QK, projection: [ b, m, p, h ]}
    - {name: V, projection: { B: b, M: p, H: h, E: f}}
    - {name: AV, projection: [ b, m, h, f ], output: True}

  - name: Z
    tensors:
    - {name: AV, projection: [ b, m, h, F ]}  
    - {name: WZ, projection: [ h, F, g ]}
    - {name: Z, projection: [ b, m, g ], output: True}

  - name: FFA
    tensors:
    - {name: Z, projection: [ b, m, g ]}
    - {name: WFFA, projection: [ g, c ]}
    - {name: FFA, projection: [ b, m, c ], output: True}

  - name: FFB
    tensors:
    - {name: FFA, projection: [ b, m, c ]}
    - {name: WFFB, projection: [ c, j ]}
    - {name: FFB, projection: [ b, m, j ], output: True}

# renames:
#   version: 0.5
#   einsums:
#   - name: default
#     tensors:
#     - name: weight
#       source: ~(Outputs() | Intermediates())
#       injective: True
#     - name: output
#       source: Outputs()
#       injective: True
#     - name: input
#       source: ~(output | weight)
#       injective: True
#   - name: QK
#     tensors:
#     - name: weight
#       source: QK
#       injective: True
#   - name: AV
#     tensors:
#     - name: weight
#       source: AV
#       injective: True
