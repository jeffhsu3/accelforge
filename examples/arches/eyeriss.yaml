arch:
  extra_attributes_for_all_component_models: {tech_node: 65e-9}
  # ============================================================
  # Architecture Description
  # ============================================================
  nodes: # Top-level is hierarchical
  - !Memory # DRAM main memory
    name: MainMemory
    component_class: LPDDR4
    size: inf
    tensors: {keep: ~Intermediates, may_keep: All}

  - !Memory
    name: GlobalBuffer
    component_class: SmartBufferSRAM
    size: 1024 * 1024 # 1Mb
    # 32 reads and writes per cycle, 200MHz. Note that the bits per read/write is the
    # bits per action set below. This is optional, and if it is omitted, then the total
    # latency is the sum of the latencies of all actions, and action latency is taken
    # from the component models.
    total_latency: (read_actions + write_actions) / 32 / 200e6
    extra_attributes_for_component_model: {n_banks: 32}
    actions:
    - {name: read, bits_per_action: 64}
    - {name: write, bits_per_action: 64}
    tensors: {keep: ~MainMemory, may_keep: All}

  - !Container
    name: ProcessingElement
    spatial:
    - {name: reuse_weight, fanout: 14, may_reuse: weight, reuse: weight, min_usage: 1}
    - {name: reuse_output, fanout: 12, may_reuse: output, reuse: output, min_usage: 1}

  - !Memory # Input scratchpad
    name: InputScratchpad
    component_class: SmartBufferSRAM
    size: 12 * 16 # 12 16b entries
    tensors: {keep: input}

  - !Memory # Weight scratchpad
    name: WeightScratchpad
    component_class: SmartBufferSRAM
    size: 192 * 16 # 12 16b entries
    tensors: {keep: weight}

  - !Memory # Output scratchpad
    name: OutputScratchpad
    component_class: SmartBufferSRAM
    size: 16 * 16 # 16 16b entries
    tensors: {keep: output}

  - !Compute # MAC unit
    name: MAC
    component_class: IntMAC
    total_latency: compute_actions / 200e6
    extra_attributes_for_component_model: {multiplier_width: 8, adder_width: 16}
