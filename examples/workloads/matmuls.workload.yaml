workload:
  iteration_space_shape:
    {% set M = M | default(128) %}
    {% set KN = KN | default(128) %}
    m:  0 <= m  < {{M}}
    {% for i in range(N_EINSUMS+1) %}
    n{{i}}: 0 <= n{{i}} < {{KN}}
    {% endfor %}

  einsums:
  {% for i in range(N_EINSUMS) %}
  - name: Matmul{{i}}
    tensor_accesses:
    - {name: T{{i}}, projection: [m, n{{i}}]}
    - {name: W{{i}}, projection: [n{{i}}, n{{i+1}}]}
    - {name: T{{i+1}}, projection: [m, n{{i+1}}], output: True}
    renames: {weight: W{{i}}, input: T{{i}}, output: T{{i+1}}}
  {% endfor %}