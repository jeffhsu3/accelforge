# Einsum YAMLs

Einsum YAMLs are designed to be as similar as possible to the Einsum notation.

```yaml
einsums:

# Einsum for a convolutional layer
- name: Conv

  # List the rank variables that participate in this Einsum.
  variables: [p, q, r, s, c, n, m]

  # List the tensors that participate in this Einsum. If a tensor is indexed
  # directly by rank variables (*i.e.,* no expressions) and the rank variable
  # names match the rank names, we can omit the rank names. If tensors are
  # indexed by expressions or the rank variable names do not match the rank
  # names, we can provide the projection explicitly for each rank. Any
  # ISL-supported expression is allowed.
  tensors:
  - name: Weights
    projection: [r, s, c, m]
  - name: Outputs
    projection: [p, q, n, m]
    output: True
  - name: Inputs
    projection:
      h: p+r
      W: q+s
      c: c
      N: n

  # The instance is any valid ISL expression to constrain the rank variables.
  instance: >-
    0 <= p < 224 and
    0 <= q < 224 and
    0 <= r < 5 and
    0 <= s < 5 and
    0 <= c < 3 and
    0 <= n < 8 and
    0 <= m < 64
```

Yaml for an MHA workload:

```yaml
problem:
  global_instance:
    b: 0 <= b < {{B}}
    m: 0 <= m < {{M}}
    h: 0 <= h < {{H}}
    e: 0 <= e < {{E}}
    d: 0 <= d < {{D}}
    c: 0 <= c < {{C}}
    j: 0 <= j < {{D}}
    g: 0 <= g < {{G}}
  
  einsums:
  - name: V
    variables: [ b, m, h, e, d ]
    tensors:
    - {name: I, projection: [ b, m, d ]}
    - {name: WV, projection: [ h, e, d ]}
    - {name: V, projection: [ b, m, h, e ], output: True}


  - name: K
    variables: [ b, m, h, e, d ]
    tensors:
    - {name: I, projection: [ b, m, d ]} 
    - {name: WK, projection: [ h, e, d ]}
    - {name: K, projection: [ b, m, h, e ], output: True}


  - name: Q
    variables: [ b, m, h, e, d ]
    tensors:
    - {name: I, projection: [ b, m, d ]}
    - {name: WQ, projection: [ h, e, d ]}
    - {name: Q, projection: [ b, m, h, e ], output: True}


  - name: QK
    variables: [ b, h, m, P, e ]
    tensors:
    - {name: Q, projection: [ b, m, h, e ]}
    - {name: K, projection: { B: b, m: P, h: h, e: e }}
    - {name: QK, projection: [ b, m, P, h ], output: True}


  - name: AV
    variables: [ b, h, m, p, f ]
    tensors:
    - {name: QK, projection: [ b, m, p, h ]}
    - {name: V, projection: { b: b, m: p, h: h, e: f}}
    - {name: AV, projection: [ b, m, h, f ], output: True}


  - name: Z
    variables: [ b, m, h, F, g ]
    tensors:
    - {name: AV, projection: [ b, m, h, F ]}  
    - {name: W, projection: [ h, F, g ]}
    - {name: Z, projection: [ b, m, g ], output: True}


  - name: FFA
    variables: [ b, m, g, c ]
    tensors:
    - {name: Z, projection: [ b, m, g ]}
    - {name: W, projection: [ g, c ]}
    - {name: FFA, projection: [ b, m, c ], output: True}


  - name: FFB
    variables: [ b, m, c, j ]
    tensors:
    - {name: FFA, projection: [ b, m, c ]}
    - {name: W, projection: [ c, j ]}
    - {name: FFB, projection: [ b, m, j ], output: True}
```


# ```yaml
# problem:
# problem:
#   global_instance:
#     b: 0 <= b < {b}
#     m: 0 <= m < {m}
#     h: 0 <= h < {h}
#     e: 0 <= e < {e}
#     d: 0 <= d < {d}
#     c: 0 <= c < {c}
#     j: 0 <= j < {D}
#     g: 0 <= g < {G}

#   einsums:
#     - name: V
#       variables: [ b, m, h, e, d ]
#       tensors:
#         I: {projection: [ b, m, d ]}
#         WV: {projection: [ h, e, d ]}
#         V: {projection: [ b, m, h, e ], output: True}

#     - name: K
#       variables: [ b, m, h, e, d ]
#       tensors:
#         I: {projection: [ b, m, d ]} 
#         WK: {projection: [ h, e, d ]}
#         K: {projection: [ b, m, h, e ], output: True}

#     - name: Q
#       variables: [ b, m, h, e, d ]
#       tensors:
#         I: {projection: [ b, m, d ]}
#         WQ: {projection: [ h, e, d ]}
#         Q: {projection: [ b, m, h, e ], output: True}

#     - name: QK
#       variables: [ b, h, m, P, e ]
#       tensors:
#         Q: {projection: [ b, m, h, e ]}
#         K: {projection: { B: b, m: P, h: h, e: e }}
#         QK: {projection: [ b, m, P, h ], output: True}

#     - name: AV
#       variables: [ b, h, m, p, f ]
#       tensors:
#         QK: {projection: [ b, m, p, h ]}
#         V: {projection: { b: b, m: p, h: h, e: f}}
#         AV: {projection: [ b, m, h, f ], output: True}

#     - name: Z
#       variables: [ b, m, h, F, g ]
#       tensors:
#         AV: {projection: [ b, m, h, F ]}  
#         W: {projection: [ h, F, g ]}
#         Z: {projection: [ b, m, g ], output: True}

#     - name: FFA
#       variables: [ b, m, g, c ]
#       tensors:
#         Z: {projection: [ b, m, g ]}
#         W: {projection: [ g, c ]}
#         FFA: {projection: [ b, m, c ], output: True}

#     - name: FFB
#       variables: [ b, m, c, j ]
#       tensors:
#         FFA: {projection: [ b, m, c ]}
#         W: {projection: [ c, j ]}
#         FFB: {projection: [ b, m, j ], output: True}
# ``` 