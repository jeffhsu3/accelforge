workload:
  version: "0.5"
  shape:
    b: 0 <= b < 1
    m: 0 <= m < 128
    p: 0 <= p < 128 # = m
    h: 0 <= h < 8
    e: 0 <= e < 32
    f: 0 <= f < 32
    d: 0 <= d < 256 # = e * h
    c: 0 <= c < 1024
    j: 0 <= j < 256
    g: 0 <= g < 256

  einsums:
  - name: I
    is_copy_operation: True
    tensor_accesses:
    - {name: I_in, projection: [b, m, d]}
    - {name: I, projection: [b, m, d], output: True}

  - name: V
    tensor_accesses:
    - {name: I, projection: [b, m, d]}
    - {name: WV, projection: [h, e, d]}
    - {name: V, projection: [b, m, h, e], output: True}

  - name: K
    tensor_accesses:
    - {name: I, projection: [b, m, d]}
    - {name: WK, projection: [h, e, d]}
    - {name: K, projection: [b, m, h, e], output: True}

  - name: Q
    tensor_accesses:
    - {name: I, projection: [b, m, d]}
    - {name: WQ, projection: [h, e, d]}
    - {name: Q, projection: [b, m, h, e], output: True}

  - name: QK
    tensor_accesses:
    - {name: Q, projection: [b, m, h, e]}
    - {name: K, projection: { B: b, M: p, H: h, E: e }}
    - {name: QK, projection: [b, m, p, h], output: True}

  - name: AV
    tensor_accesses:
    - {name: QK, projection: [b, m, p, h]}
    - {name: V, projection: { B: b, M: p, H: h, E: f}}
    - {name: AV, projection: [b, m, h, f], output: True}

  - name: Z
    tensor_accesses:
    - {name: AV, projection: [b, m, h, f]}
    - {name: WZ, projection: [h, f, g]}
    - {name: Z, projection: [b, m, g], output: True}

  - name: FFA
    tensor_accesses:
    - {name: Z, projection: [b, m, g]}
    - {name: WFFA, projection: [g, c]}
    - {name: FFA, projection: [b, m, c], output: True}

  - name: FFB
    tensor_accesses:
    - {name: FFA, projection: [b, m, c]}
    - {name: WFFB, projection: [c, j]}
    - {name: FFB, projection: [b, m, j], output: True}
