renames:
  version: "0.5"
  einsums:
  - name: default
    tensor_accesses:
    - name: input
      source: Inputs() & Intermediates()
      expected_count: 1
    - name: output
      source: Outputs()
      expected_count: 1
    - name: weight
      source: ~(input | output)
      expected_count: 1

    rank_variables:
    - name: head
      source: h
      expected_count: 1
    - name: parallel_rank
      source: (output.rank_variables() & weight.rank_variables()) - head
      expected_count: 1
    - name: reduced_rank
      source: input.rank_variables() & weight.rank_variables() - head - output.rank_variables() - parallel_rank
      expected_count: 1

  - name: I
    tensor_accesses:
    - name: weight
      source: Nothing
    - name: input
      source: Inputs()
    {% if FFMT | default(false) %}
    - name: Intermediates
      source: Nothing
    {% endif %}
    rank_variables:
    - {name: head, source: Nothing().rank_variables()}
    - {name: reduced_rank, source: b, expected_count: 1}
    - {name: parallel_rank, source: m, expected_count: 1}

  - name: QK
    tensor_accesses:
    - name: input
      source: Q
      expected_count: 1
    rank_variables:
    - {name: parallel_rank, source: m, expected_count: 1}

  - name: AV
    tensor_accesses:
    - name: input
      source: QK
      expected_count: 1
    rank_variables:
    - {name: parallel_rank, source: f, expected_count: 1}
    # - {name: reduced_rank, source: p, expected_count: 1}

  - name: FFA
    rank_variables:
    - {name: head, source: Nothing().rank_variables()}

  - name: FFB
    rank_variables:
    - {name: head, source: Nothing().rank_variables()}

